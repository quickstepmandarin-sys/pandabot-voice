<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PandaBot è¯­éŸ³èŠå¤© - ç”¨ AI å­¦ä¸­æ–‡</title>
  <style>
    body {
      font-family: 'Comic Sans MS', sans-serif;
      text-align: center;
      padding: 40px;
      background: linear-gradient(to bottom, #fff9e6, #ffe08c);
    }
    h1 { font-size: 2.8em; color: #2a9d8f; margin-bottom: 10px; }
    p.intro {
      font-size: 18px;
      line-height: 1.6;
      max-width: 700px;
      margin: 0 auto 30px auto;
      color: #333;
    }
    #chatOutput {
      margin-top: 30px;
      font-size: 18px;
      min-height: 200px;
      background: #fff;
      padding: 20px;
      border-radius: 20px;
      width: 90%;
      max-width: 600px;
      margin: 0 auto;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      overflow-y: auto;
      max-height: 400px;
      text-align: left;
    }
    button, .buyCoffeeBtn, .bookBtn {
      font-size: 18px;
      padding: 12px 28px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
      margin-top: 15px;
      text-decoration: none;
      display: inline-block;
    }
    button { background-color: #f4a261; color: white; }
    button:hover { background-color: #e76f51; }
    .buyCoffeeBtn { background-color: #ff813f; color: white; }
    .buyCoffeeBtn:hover { background-color: #e76f51; }
    .bookBtn { background-color: #2a9d8f; color: white; margin: 5px; }
    .bookBtn:hover { background-color: #1f7a6f; }
    #monetization { margin-top: 40px; }
    #books { margin-top: 30px; }
    .bookContainer { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
  </style>
</head>
<body>
  <h1>ğŸ¼ PandaBot</h1>
  <p class="intro">
    Welcome to PandaBot â€” your AI Chinese learning partner! ğŸ‰  
    Whether you're a beginner or want to improve your Chinese conversation skills, PandaBot is here to chat with you, help you understand Chinese sentences, and respond with voice in real time!  
    Start chatting now and begin your Chinese learning journey with AI!  
    ç°åœ¨å°±å¼€å§‹èŠå¤©å§ï¼ğŸ¼
  </p>

  <button id="startButton">ğŸ™ï¸ Start Chatting</button>
  <div id="chatOutput"></div>

  <!-- Monetization Section -->
  <div id="monetization">
    <h2>Support Us â˜•</h2>
    <a href="https://www.buymeacoffee.com/quickstepmandarin" target="_blank" class="buyCoffeeBtn">Buy Me a Coffee</a>
  </div>

  <!-- Book Promotion Section -->
  <div id="books">
    <h2>My Books ğŸ“š</h2>
    <div class="bookContainer">
      <a href="https://quickstepmandarin-sys.github.io/kids-landing-page/" target="_blank" class="bookBtn">Laugh, Play & Learn Chinese</a>
      <a href="https://www.amazon.com/dp/B0D9WMGVJ5" target="_blank" class="bookBtn">Quickstep Mandarin System</a>
    </div>
  </div>

  <script>
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'zh-CN';
    recognition.interimResults = false;

    recognition.onresult = (event) => {
      const userText = event.results[0][0].transcript;
      appendChat('ä½ ', userText);
      callServer(userText);
    };

    document.getElementById('startButton').onclick = () => recognition.start();

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'zh-CN';
      speechSynthesis.speak(utterance);
    }

    function appendChat(sender, text) {
      const c = document.getElementById('chatOutput');
      c.innerHTML += `<b>${sender}:</b> ${text}<br>`;
      c.scrollTop = c.scrollHeight;
    }

    async function callServer(message) {
      appendChat('ğŸ¼ PandaBot', '...');
      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userInput: message })
        });

        const data = await res.json();
        const reply = data.raw?.text || data.reply || "æˆ‘æ²¡å¬æ‡‚ï¼Œè¯·å†è¯´ä¸€æ¬¡ï½";

        appendChat('ğŸ¼ PandaBot', reply);
        speak(reply);
      } catch (err) {
        appendChat('ğŸ¼ PandaBot', 'ç³Ÿç³•ï¼Œä¼ºæœå™¨å‡ºç¾å•é¡Œäº†ã€‚');
        console.error("Error calling API:", err);
      }
    }
  </script>
</body>
</html>
